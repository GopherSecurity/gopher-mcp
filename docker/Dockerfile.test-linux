# Test container for verifying the Linux build
FROM ubuntu:20.04

# Install runtime dependencies
RUN apt-get update && apt-get install -y \
    libcurl4 \
    libssl1.1 \
    && rm -rf /var/lib/apt/lists/*

# Copy the library
WORKDIR /app
COPY build-output/linux-x64/libgopher_mcp_auth.so* /usr/local/lib/

# Update library cache
RUN ldconfig

# Create a simple test script
RUN echo '#!/bin/bash' > /app/test.sh && \
    echo 'echo "Library dependencies:"' >> /app/test.sh && \
    echo 'ldd /usr/local/lib/libgopher_mcp_auth.so.0.1.0' >> /app/test.sh && \
    echo 'echo ""' >> /app/test.sh && \
    echo 'echo "Library info:"' >> /app/test.sh && \
    echo 'ls -lah /usr/local/lib/libgopher_mcp_auth.so*' >> /app/test.sh && \
    chmod +x /app/test.sh

CMD ["/app/test.sh"]