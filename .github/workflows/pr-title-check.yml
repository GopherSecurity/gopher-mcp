name: PR Title and Commit Check

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  check-pr-title:
    name: Check PR Title Format
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      issues: write
    
    steps:
    - name: Check PR title
      uses: actions/github-script@v6
      with:
        script: |
          const prTitle = context.payload.pull_request.title;
          const prNumber = context.payload.pull_request.number;
          
          // Check if PR title already has a PR number
          const prNumberPattern = /\(#\d+\)$/;
          if (prNumberPattern.test(prTitle)) {
            console.log('PR title already contains a PR number');
            return;
          }
          
          // Suggest adding PR number
          const suggestedTitle = `${prTitle} (#${prNumber})`;
          
          // Simply log the suggestion instead of creating a comment
          console.log(`::notice title=PR Title Suggestion::Consider updating PR title to: ${suggestedTitle}`);
          
          // Set output for other steps to use
          core.setOutput('suggested_title', suggestedTitle);
          core.setOutput('needs_pr_number', 'true');